<div align="center">
  <img width="1200" height="475" alt="GHBanner" src="https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6" />
</div>

# Silent Scream · High School Reality

一个用 React + Vite 做的静态网页项目，包含数据可视化、宣言文本、分享卡片与「回声墙（留言板）」。适合部署到 GitHub Pages 等静态托管；在中国大陆不依赖 Vercel 也能访问。

## 功能

- **回声墙**：默认本地模式（localStorage）；配置 Supabase 后可全网同步 + 实时更新
- **AI 树洞**：前端通过 `/api/gemini` 调用后端代理；纯静态托管时会自动禁用（不影响其他功能）
- **分享卡片**：生成图片/二维码用于传播

## 环境要求

- Node.js（建议 18+）

## 本地运行

```bash
npm install
cp .env.example .env.local
npm run dev
```

可选：`npm run typecheck`

## 环境变量

前端构建时会把以 `VITE_` 开头的变量写进 bundle（可公开的才放这里）。

- `VITE_SUPABASE_URL`：Supabase Project URL（可公开）
- `VITE_SUPABASE_ANON_KEY`：Supabase anon/public key（可公开；不要用 service_role）
- `GEMINI_API_KEY`：仅用于后端 `/api/gemini`（不要放到前端；不要提交到仓库）

提示：`.env.local` 不要提交（本仓库默认已忽略 `*.local`）。

## 回声墙（Supabase 全网同步）

回声墙支持两种模式：

- **本地模式**：未配置 Supabase 时启用，留言只保存在当前浏览器（别人看不到）
- **全网模式（Realtime）**：配置 Supabase 后启用，留言写入数据库并实时订阅更新（别人也能看到）

### 1) 创建表 + RLS（匿名读/写）

在 Supabase Dashboard → SQL Editor 运行：

```sql
create table public.messages (
  id bigint generated by default as identity primary key,
  name text,
  identity text,
  content text,
  province text,
  created_at timestamptz default now()
);

alter table public.messages enable row level security;

create policy "public read"
on public.messages
for select
using (true);

create policy "public insert"
on public.messages
for insert
with check (true);
```

然后在 Supabase → Database → Replication / Realtime（界面可能有差异）里开启 `public.messages` 的 Realtime。

### 2) 配置前端环境变量

本地开发：写入 `.env.local`：

```ini
VITE_SUPABASE_URL=...
VITE_SUPABASE_ANON_KEY=...
```

部署到 GitHub Pages：把同名变量配置到 GitHub Actions（见下文）。

### 3) CORS / Allowed Origins（重要）

如果你部署在 GitHub Pages，请在 Supabase Dashboard → Project Settings → API（或 CORS/Allowed Origins）里把你的域名加进去，例如：

- `https://<username>.github.io`
- `http://localhost:3000`

否则可能出现“本地模式/连接失败/写入失败”。（因为浏览器会带 Origin，Supabase 会做 CORS 校验）

## 部署（GitHub Pages · 标准方式）

标准方式指：**Actions 自动构建 `dist/` 并发布**。访问稳定，Supabase 全网模式也更稳定（https 打开，避免 `file://` 的限制）。

### 1) 开启 Pages（一次性）

GitHub 仓库 → Settings → Pages → Build and deployment：

- Source 选择 **GitHub Actions**

### 2) 配置 Supabase（可选，但你要全网同步就必须）

GitHub 仓库 → Settings → Secrets and variables → Actions：

把下面两个值添加为 **Variables 或 Secrets**（二选一）：

- `VITE_SUPABASE_URL`
- `VITE_SUPABASE_ANON_KEY`

### 3) 推送触发部署

把代码推到 `main` 分支后，Actions 会自动部署。完成后访问：

`https://<username>.github.io/<repo>/`

说明：工作流会自动设置 Vite 的 `base` 为 `/<repo>/`，所以静态资源路径不会 404。

## 单文件导出（可选）

### 离线单文件（一定是本地模式）

```bash
npm run build:single
```

生成 `dist/silent-scream.html`：可直接发给别人双击打开；回声墙为本地模式；AI 默认禁用。

### 单文件 + Supabase（全网同步）

```bash
npm run build:single:online
```

生成 `dist/silent-scream-online.html`：需要通过 `https://`（或本地 http server）打开才稳定；如果直接双击 `file://`，部分浏览器会被 CORS/Origin 限制。

## AI（/api/gemini）说明

本项目的 AI 功能通过 `/api/gemini` 访问后端代理（`api/gemini.js`）。

- GitHub Pages 是纯静态托管，不提供 `/api/*`，所以 AI 会自动显示为不可用
- 如果你需要 AI：需要额外部署一个可访问的后端，并保证前端能请求到 `/api/gemini`

## 常用命令

```bash
npm run dev                 # 本地开发
npm run build               # 构建到 dist/
npm run preview             # 预览 dist/
npm run typecheck           # TS 类型检查
npm run build:single        # 导出离线单文件（本地留言模式）
npm run build:single:online # 导出单文件（Supabase 全网留言）
```

## 排查：为什么还是“本地模式”？

- 你部署出来的那次构建里没有注入 `VITE_SUPABASE_URL` / `VITE_SUPABASE_ANON_KEY`（Vite 是构建时注入，不是运行时读取）
- Supabase 没建表 / 没开 RLS policy / 没开启 Realtime
- Supabase 没配置 Allowed Origins（CORS）包含你的 Pages 域名

